{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.214.0"},"children":{"SpendMonitorStack":{"id":"SpendMonitorStack","path":"SpendMonitorStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.214.0"},"children":{"SpendMonitorLogGroup":{"id":"SpendMonitorLogGroup","path":"SpendMonitorStack/SpendMonitorLogGroup","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.214.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"SpendMonitorStack/SpendMonitorLogGroup/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"logGroupName":"/aws/lambda/spend-monitor-agent","retentionInDays":30}}}}},"SpendAlertTopic":{"id":"SpendAlertTopic","path":"SpendMonitorStack/SpendAlertTopic","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.Topic","version":"2.214.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"SpendMonitorStack/SpendAlertTopic/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.CfnTopic","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SNS::Topic","aws:cdk:cloudformation:props":{"displayName":"AWS Spend Monitor Alerts","topicName":"aws-spend-alerts"}}}}},"DeviceTokenTable":{"id":"DeviceTokenTable","path":"SpendMonitorStack/DeviceTokenTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.214.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"SpendMonitorStack/DeviceTokenTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"deviceToken","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","keySchema":[{"attributeName":"deviceToken","keyType":"HASH"}],"pointInTimeRecoverySpecification":{"pointInTimeRecoveryEnabled":true},"tableName":"spend-monitor-device-tokens"}}},"ScalingRole":{"id":"ScalingRole","path":"SpendMonitorStack/DeviceTokenTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.214.0","metadata":[]}}}},"SpendMonitorAgent":{"id":"SpendMonitorAgent","path":"SpendMonitorStack/SpendMonitorAgent","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.214.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"SpendMonitorStack/SpendMonitorAgent/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.214.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"SpendMonitorStack/SpendMonitorAgent/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.214.0","metadata":[]}},"Resource":{"id":"Resource","path":"SpendMonitorStack/SpendMonitorAgent/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"SpendMonitorStack/SpendMonitorAgent/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.214.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"SpendMonitorStack/SpendMonitorAgent/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["ce:GetCostAndUsage","ce:GetDimensionValues","ce:GetReservationCoverage","ce:GetReservationPurchaseRecommendation","ce:GetReservationUtilization","ce:GetUsageReport","cloudwatch:PutMetricData"],"Effect":"Allow","Resource":"*"},{"Action":"sns:Publish","Effect":"Allow","Resource":{"Ref":"SpendAlertTopic7E2315E1"}},{"Action":["dynamodb:BatchGetItem","dynamodb:BatchWriteItem","dynamodb:ConditionCheckItem","dynamodb:DeleteItem","dynamodb:DescribeTable","dynamodb:GetItem","dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:PutItem","dynamodb:Query","dynamodb:Scan","dynamodb:UpdateItem"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["DeviceTokenTable5D54629B","Arn"]},{"Ref":"AWS::NoValue"}]}],"Version":"2012-10-17"},"policyName":"SpendMonitorAgentServiceRoleDefaultPolicyC1138BB7","roles":[{"Ref":"SpendMonitorAgentServiceRoleD4CAE3C2"}]}}}}}}},"Code":{"id":"Code","path":"SpendMonitorStack/SpendMonitorAgent/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.214.0"},"children":{"Stage":{"id":"Stage","path":"SpendMonitorStack/SpendMonitorAgent/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.214.0"}},"AssetBucket":{"id":"AssetBucket","path":"SpendMonitorStack/SpendMonitorAgent/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.214.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"SpendMonitorStack/SpendMonitorAgent/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-710603110067-us-east-1","s3Key":"20c6e518897152edcc4eafbbd322906f52e24272f4df9ce078a1d4b690d5dd86.zip"},"environment":{"variables":{"SNS_TOPIC_ARN":{"Ref":"SpendAlertTopic7E2315E1"},"SPEND_THRESHOLD":"10","CHECK_PERIOD_DAYS":"1","RETRY_ATTEMPTS":"3","MIN_SERVICE_COST":"1","IOS_PLATFORM_APP_ARN":"","IOS_BUNDLE_ID":"com.vinny.aws.spendmonitor","APNS_SANDBOX":"true","DEVICE_TOKEN_TABLE_NAME":{"Ref":"DeviceTokenTable5D54629B"}}},"handler":"index.handler","loggingConfig":{"logGroup":{"Ref":"SpendMonitorLogGroup367930B7"}},"memorySize":512,"role":{"Fn::GetAtt":["SpendMonitorAgentServiceRoleD4CAE3C2","Arn"]},"runtime":"nodejs18.x","timeout":300}}}}},"SpendCheckSchedule":{"id":"SpendCheckSchedule","path":"SpendMonitorStack/SpendCheckSchedule","constructInfo":{"fqn":"aws-cdk-lib.aws_events.Rule","version":"2.214.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"SpendMonitorStack/SpendCheckSchedule/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_events.CfnRule","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Events::Rule","aws:cdk:cloudformation:props":{"description":"Daily AWS spend check at 9:00 UTC","scheduleExpression":"cron(0 9 * * ? *)","state":"ENABLED","targets":[{"id":"Target0","arn":{"Fn::GetAtt":["SpendMonitorAgentBEC3B4B9","Arn"]}}]}}},"AllowEventRuleSpendMonitorStackSpendMonitorAgent55373C34":{"id":"AllowEventRuleSpendMonitorStackSpendMonitorAgent55373C34","path":"SpendMonitorStack/SpendCheckSchedule/AllowEventRuleSpendMonitorStackSpendMonitorAgent55373C34","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["SpendMonitorAgentBEC3B4B9","Arn"]},"principal":"events.amazonaws.com","sourceArn":{"Fn::GetAtt":["SpendCheckSchedule7DC10937","Arn"]}}}}}},"OperationalAlertTopic":{"id":"OperationalAlertTopic","path":"SpendMonitorStack/OperationalAlertTopic","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.Topic","version":"2.214.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"SpendMonitorStack/OperationalAlertTopic/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.CfnTopic","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SNS::Topic","aws:cdk:cloudformation:props":{"displayName":"Spend Monitor Operational Alerts","topicName":"spend-monitor-ops-alerts"}}}}},"LambdaErrorAlarm":{"id":"LambdaErrorAlarm","path":"SpendMonitorStack/LambdaErrorAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.214.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"SpendMonitorStack/LambdaErrorAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmActions":[{"Ref":"OperationalAlertTopicB3F33E16"}],"alarmDescription":"Alarm for Lambda function errors in spend monitor","alarmName":"SpendMonitor-LambdaErrors","comparisonOperator":"GreaterThanOrEqualToThreshold","dimensions":[{"name":"FunctionName","value":{"Ref":"SpendMonitorAgentBEC3B4B9"}}],"evaluationPeriods":1,"metricName":"Errors","namespace":"AWS/Lambda","period":300,"statistic":"Sum","threshold":1,"treatMissingData":"notBreaching"}}}}},"LambdaDurationAlarm":{"id":"LambdaDurationAlarm","path":"SpendMonitorStack/LambdaDurationAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.214.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"SpendMonitorStack/LambdaDurationAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmActions":[{"Ref":"OperationalAlertTopicB3F33E16"}],"alarmDescription":"Alarm for Lambda function execution duration","alarmName":"SpendMonitor-LambdaDuration","comparisonOperator":"GreaterThanOrEqualToThreshold","dimensions":[{"name":"FunctionName","value":{"Ref":"SpendMonitorAgentBEC3B4B9"}}],"evaluationPeriods":2,"metricName":"Duration","namespace":"AWS/Lambda","period":300,"statistic":"Average","threshold":240000,"treatMissingData":"notBreaching"}}}}},"ExecutionFailureAlarm":{"id":"ExecutionFailureAlarm","path":"SpendMonitorStack/ExecutionFailureAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.214.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"SpendMonitorStack/ExecutionFailureAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmActions":[{"Ref":"OperationalAlertTopicB3F33E16"}],"alarmDescription":"Alarm for spend monitor execution failures","alarmName":"SpendMonitor-ExecutionFailures","comparisonOperator":"GreaterThanOrEqualToThreshold","dimensions":[{"name":"Operation","value":"SpendMonitoring"}],"evaluationPeriods":1,"metricName":"ErrorRate","namespace":"SpendMonitor/Agent","period":300,"statistic":"Sum","threshold":1,"treatMissingData":"notBreaching"}}}}},"AlertDeliveryFailureAlarm":{"id":"AlertDeliveryFailureAlarm","path":"SpendMonitorStack/AlertDeliveryFailureAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.214.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"SpendMonitorStack/AlertDeliveryFailureAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmActions":[{"Ref":"OperationalAlertTopicB3F33E16"}],"alarmDescription":"Alarm for alert delivery failures","alarmName":"SpendMonitor-AlertDeliveryFailures","comparisonOperator":"GreaterThanOrEqualToThreshold","dimensions":[{"name":"Status","value":"Failure"}],"evaluationPeriods":1,"metricName":"AlertDeliveryCount","namespace":"SpendMonitor/Agent","period":300,"statistic":"Sum","threshold":1,"treatMissingData":"notBreaching"}}}}},"SpendMonitorDashboard":{"id":"SpendMonitorDashboard","path":"SpendMonitorStack/SpendMonitorDashboard","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Dashboard","version":"2.214.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"SpendMonitorStack/SpendMonitorDashboard/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnDashboard","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Dashboard","aws:cdk:cloudformation:props":{"dashboardBody":{"Fn::Join":["",["{\"widgets\":[{\"type\":\"metric\",\"width\":12,\"height\":6,\"x\":0,\"y\":0,\"properties\":{\"view\":\"timeSeries\",\"title\":\"Lambda Function Metrics\",\"region\":\"",{"Ref":"AWS::Region"},"\",\"metrics\":[[\"AWS/Lambda\",\"Invocations\",\"FunctionName\",\"",{"Ref":"SpendMonitorAgentBEC3B4B9"},"\",{\"stat\":\"Sum\"}],[\"AWS/Lambda\",\"Errors\",\"FunctionName\",\"",{"Ref":"SpendMonitorAgentBEC3B4B9"},"\",{\"stat\":\"Sum\"}],[\"AWS/Lambda\",\"Duration\",\"FunctionName\",\"",{"Ref":"SpendMonitorAgentBEC3B4B9"},"\",{\"yAxis\":\"right\"}]],\"yAxis\":{}}},{\"type\":\"metric\",\"width\":12,\"height\":6,\"x\":0,\"y\":6,\"properties\":{\"view\":\"timeSeries\",\"title\":\"Spend Monitoring Metrics\",\"region\":\"",{"Ref":"AWS::Region"},"\",\"metrics\":[[\"SpendMonitor/Agent\",\"CurrentSpend\",{\"period\":3600}],[\"SpendMonitor/Agent\",\"ProjectedMonthlySpend\",{\"period\":3600}]],\"yAxis\":{}}},{\"type\":\"metric\",\"width\":12,\"height\":6,\"x\":0,\"y\":12,\"properties\":{\"view\":\"timeSeries\",\"title\":\"Alert Delivery Metrics\",\"region\":\"",{"Ref":"AWS::Region"},"\",\"metrics\":[[\"SpendMonitor/Agent\",\"AlertDeliveryCount\",\"Status\",\"Success\",{\"stat\":\"Sum\"}],[\"SpendMonitor/Agent\",\"AlertDeliveryCount\",\"Status\",\"Failure\",{\"stat\":\"Sum\"}]],\"yAxis\":{}}}]}"]]},"dashboardName":"SpendMonitorAgent"}}}}},"SNSTopicArn":{"id":"SNSTopicArn","path":"SpendMonitorStack/SNSTopicArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.214.0"}},"AgentFunctionName":{"id":"AgentFunctionName","path":"SpendMonitorStack/AgentFunctionName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.214.0"}},"DeviceTokenTableName":{"id":"DeviceTokenTableName","path":"SpendMonitorStack/DeviceTokenTableName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.214.0"}},"LogGroupName":{"id":"LogGroupName","path":"SpendMonitorStack/LogGroupName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.214.0"}},"OperationalAlertTopicArn":{"id":"OperationalAlertTopicArn","path":"SpendMonitorStack/OperationalAlertTopicArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.214.0"}},"DashboardURL":{"id":"DashboardURL","path":"SpendMonitorStack/DashboardURL","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.214.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"SpendMonitorStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"SpendMonitorStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.214.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"SpendMonitorStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.214.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"SpendMonitorStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.214.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}}}}